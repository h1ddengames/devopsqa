!function(e,t){function n(e,n){var i=" to exec 「"+e+"」 command"+(n?" with value: "+n:"");try{t.execCommand(e,!1,n)}catch(e){return K.log("fail"+i,!0)}K.log("success"+i)}function i(e,t,i){var r=w(e);if(r)return e._range.selectNode(r),e._range.collapse(!1),"insertimage"===t&&e._menu&&I(e._menu,!0),n(t,i)}function r(e,t){return-1!==A(e).map(function(e){return e.nodeName.toLowerCase()}).indexOf(t)&&(t="p"),n("formatblock",t)}function o(e,t,i){return i="<"+t+">"+(i||U.toString())+"</"+t+">",n("insertHTML",i)}function a(e,t,i){return e.config.linksInNewWindow&&"unlink"!==t?(i='<a href="'+i+'" target="_blank">'+U.toString()+"</a>",n("insertHTML",i)):n(t,i)}function c(e,t,n,i){var r=e.config.titles[t]||"",o=document.createElement("div");o.classList.add("pen-icon"),o.setAttribute("title",r),"parent"===n?(o.classList.add("pen-group-icon"),o.setAttribute("data-group-toggle",t)):o.setAttribute("data-action",t),"child"===n&&o.setAttribute("data-group",i);var a=e.config.toolbarIconsDictionary[t];if(a&&a.text)o.textContent=a.text;else{var c;c=a&&a.className?a.className:e.config.toolbarIconsPrefix+t,o.innerHTML+='<i class="'+c+'"  ></i>'}return o.outerHTML}function s(e){return j.call(e._menu.children)}function l(e,t){s(e).forEach(function(e){I(e,e.getAttribute("data-group")!==t)}),p(e,!t),e.refreshMenuPosition()}function u(e){l(e,null),d(e,!0),h(e,!e._urlInput||""===e._urlInput.value)}function f(e){s(e).forEach(function(e){I(e,!0)}),d(e),p(e)}function d(e,t){var n=e._menu.querySelector(".pen-input-wrapper");n&&I(n,t)}function h(e,t){var n=e._menu.querySelector('[data-action="unlink"]');n&&(I(n,t),e.refreshMenuPosition())}function p(e,t){I(e._menu.querySelector('[data-action="close"]'),t),e.refreshMenuPosition()}function g(e){var n=t.createElement("div"),i=t.createElement("input"),r=t.createElement("label"),o=t.createElement("input"),a=t.createElement("i");return n.className="pen-input-wrapper",i.className="pen-url-input",i.type="url",i.placeholder="http://",r.className="pen-icon pen-input-label",o.className="pen-external-url-checkbox",o.type="checkbox",a.className=e.config.toolbarIconsDictionary.externalLink.className,r.appendChild(o),r.appendChild(a),n.appendChild(i),n.appendChild(r),n}function m(e,t,n){e.execCommand(t,n),e._range=e.getRange(),e.highlight().menu()}function v(e,t){for(var n,i=e._toolbar||e._menu;!(n=t.getAttribute("data-action"))&&t.parentNode!==i;)t=t.parentNode;var r=t.getAttribute("data-group-toggle");if(r&&l(e,r),n)if("close"!==n){if(!/(?:createlink)|(?:insertimage)/.test(n))return m(e,n);if(e._urlInput){var o=e._urlInput;if(i===e._menu?f(e):(e._inputActive=!0,e.menu()),"none"!==e._menu.style.display){setTimeout(function(){o.focus()},10);var a=function(){var t=o.value;t?(e.config.linksInNewWindow=e._externalUrlCheckbox.checked,t=o.value.replace(z.whiteSpace,"").replace(z.mailTo,"mailto:$1").replace(z.http,"http://$1")):n="unlink",m(e,n,t)};o.onkeypress=function(e){13===e.which&&(e.preventDefault(),a())},e._externalUrlCheckbox.onchange=a}}}else u(e)}function y(e){var n="",i=g(e).outerHTML;if(e._toolbar=e.config.toolbar,e._toolbar)(e._toolbar.querySelectorAll("[data-action=createlink]").length||e._toolbar.querySelectorAll("[data-action=insertimage]").length)&&(n+=i);else{var r=e.config.list;if(!Object.values(r).length)return;K.forEach(r,function(t,i){if(Array.isArray(t)){var r=t;n+=c(e,t=i,"parent"),K.forEach(r,function(i){n+=c(e,i,"child",t)},!0)}else n+=c(e,t)});var o=Object.values(r);(o.indexOf("createlink")>=0||o.indexOf("insertimage")>=0)&&(n+=i),n+=c(e,"close")}n&&(e._menu=t.createElement("div"),e._menu.setAttribute("class",e.config.class+"-menu pen-menu"),e._menu.innerHTML=n,e._urlInput=e._menu.querySelector(".pen-url-input"),e._externalUrlCheckbox=e._menu.querySelector(".pen-external-url-checkbox"),I(e._menu,!0),t.body.appendChild(e._menu))}function b(i){function r(e){i._range=i.getRange(),c(e)}var o=i._toolbar||i._menu,a=i.config.editor,c=K.delayExec(function(){o&&i.highlight().menu()}),s=function(){};if(i._menu){var l=function(){"flex"===i._menu.style.display&&i.menu()};_(i,e,"resize",l),_(i,e,"scroll",l);var u=!1;_(i,a,"mousedown",function(){u=!0}),_(i,a,"mouseleave",function(){u&&r(800),u=!1}),_(i,a,"mouseup",function(){u&&r(200),u=!1}),s=function(e){!i._menu||L(a,e.target)||L(i._menu,e.target)||(x(i,t,"click",s),c(100))}}else _(i,a,"click",function(){r(0)});_(i,a,"keyup",function(e){if(E(i),i.isEmpty())"advanced"===i.config.mode&&S(i);else{if(M(i)&&!$(i)&&"advanced"!==i.config.mode&&(a.innerHTML=a.innerHTML.replace(/\u200b/,""),R(i)),13!==e.which||e.shiftKey)return r(400);var n=w(i,!0);n&&n.nextSibling&&B.test(n.nodeName)&&n.nodeName===n.nextSibling.nodeName&&("BR"!==n.lastChild.nodeName&&n.appendChild(t.createElement("br")),K.forEach(n.nextSibling.childNodes,function(e){e&&n.appendChild(e)},!0),n.parentNode.removeChild(n.nextSibling),O(i,n.lastChild,i.getRange()))}}),_(i,a,"keydown",function(e){if(a.classList.remove(i.config.placeholderClass),13===e.which&&!e.shiftKey){var r=w(i,!0);if(r&&B.test(r.nodeName)){if(r){var o=r.lastChild;if(o&&o.previousSibling&&!o.previousSibling.textContent&&!o.textContent){e.preventDefault();var c=t.createElement("p");c.innerHTML="<br>",r.removeChild(o),r.nextSibling?r.parentNode.insertBefore(c,r.nextSibling):r.parentNode.appendChild(c),O(i,c,i.getRange())}}}else"basic"===i.config.mode&&(e.preventDefault(),n("insertHTML","<br>"))}}),o&&_(i,o,"click",function(e){v(i,e.target)}),_(i,a,"focus",function(){i.isEmpty()&&"advanced"===i.config.mode&&S(i),_(i,t,"click",s)}),_(i,a,"blur",function(){E(i),i.checkContentChange()}),_(i,a,"paste",function(){setTimeout(function(){i.cleanContent()})})}function _(e,t,n,i){if(e._events.hasOwnProperty(n))e._events[n].push(i);else{e._eventTargets=e._eventTargets||[],e._eventsCache=e._eventsCache||[];var r=e._eventTargets.indexOf(t);r<0&&(r=e._eventTargets.push(t)-1),e._eventsCache[r]=e._eventsCache[r]||{},e._eventsCache[r][n]=e._eventsCache[r][n]||[],e._eventsCache[r][n].push(i),t.addEventListener(n,i,!1)}return e}function C(e,t){if(e._events.hasOwnProperty(t)){var n=j.call(arguments,2);K.forEach(e._events[t],function(t){t.apply(e,n)})}}function x(e,t,n,i){var r=e._events[n];if(!r){var o=e._eventTargets.indexOf(t);o>=0&&(r=e._eventsCache[o][n])}if(!r)return e;var a=r.indexOf(i);return a>=0&&r.splice(a,1),t.removeEventListener(n,i,!1),e}function k(e){return K.forEach(this._events,function(e){e.length=0},!1),e._eventsCache?(K.forEach(e._eventsCache,function(t,n){var i=e._eventTargets[n];K.forEach(t,function(e,t){K.forEach(e,function(e){i.removeEventListener(t,e,!1)},!0)},!1)},!0),e._eventTargets=[],e._eventsCache=[],e):e}function E(e){e.config.editor.classList[e.isEmpty()?"add":"remove"](e.config.placeholderClass)}function N(e){return(e||"").trim().replace(/\u200b/g,"")}function L(e,t){if(e===t)return!0;for(t=t.parentNode;t;){if(t===e)return!0;t=t.parentNode}return!1}function w(e,t){var n,i=e.config.editor;if(e._range=e._range||e.getRange(),(n=e._range.commonAncestorContainer).hasChildNodes()&&e._range.startOffset+1===e._range.endOffset&&(n=n.childNodes[e._range.startOffset]),!n||n===i)return null;for(;n&&1!==n.nodeType&&n.parentNode!==i;)n=n.parentNode;for(;n&&t&&n.parentNode!==i;)n=n.parentNode;return L(i,n)?n:null}function A(e){return T(e).filter(function(e){return e.nodeName.match(W)})}function T(e){for(var t=[],n=w(e);n&&n!==e.config.editor;)n.nodeType===Node.ELEMENT_NODE&&t.push(n),n=n.parentNode;return t}function S(e){var n=e._range=e.getRange();e.config.editor.innerHTML="";var i=t.createElement("p");i.innerHTML="<br>",n.insertNode(i),O(e,i.childNodes[0],n)}function R(e){var n=e.getRange(),i=t.createTextNode("​");n.selectNodeContents(e.config.editor),n.collapse(!1),n.insertNode(i),O(e,i,n)}function M(e){var t=e.getRange(),n=t.cloneRange();return n.selectNodeContents(e.config.editor),n.setStart(t.endContainer,t.endOffset),""===n.toString()}function $(e){var t=e.getRange(),n=t.cloneRange();return n.selectNodeContents(e.config.editor),n.setEnd(t.startContainer,t.startOffset),""===n.toString()}function O(e,t,n){n.setStartAfter(t),n.setEndBefore(t),n.collapse(!1),e.setRange(n)}function q(e){if(1===e.nodeType){if(G.notLink.test(e.tagName))return;K.forEach(e.childNodes,function(e){q(e)},!0)}else if(3===e.nodeType){var n=H(e.nodeValue||"");if(!n.links)return;var i=t.createDocumentFragment(),r=t.createElement("div");for(r.innerHTML=n.text;r.childNodes.length;)i.appendChild(r.childNodes[0]);e.parentNode.replaceChild(i,e)}}function H(e){var t=0;return e=e.replace(G.url,function(e){var n=e,i=e;return t++,e.length>G.maxLength&&(i=e.slice(0,G.maxLength)+"..."),G.prefix.test(n)||(n="http://"+n),'<a href="'+n+'">'+i+"</a>"}),{links:t,text:e}}function I(e,t){e.style.display=t?"none":"flex"}var D,P,U,K={},j=Array.prototype.slice,V={block:/^(?:p|h[1-6]|blockquote|pre)$/,inline:/^(?:justify(center|full|left|right)|strikethrough|insert(un)?orderedlist|(in|out)dent)$/,biu:/^(bold|italic|underline)$/,source:/^(?:createlink|unlink)$/,insert:/^(?:inserthorizontalrule|insertimage|insert)$/,wrap:/^(?:code)$/},B=/^(?:blockquote|pre|div)$/i,W=/(?:[pubia]|strong|em|h[1-6]|blockquote|code|[uo]l|li)/i,z={whiteSpace:/(^\s+)|(\s+$)/g,mailTo:/^(?!mailto:|.+\/|.+#|.+\?)(.*@.*\..+)$/,http:/^(?!\w+?:\/\/|mailto:|\/|\.\/|\?|#)(.*)$/},G={url:/((https?|ftp):\/\/|www\.)[^\s<]{3,}/gi,prefix:/^(?:https?|ftp):\/\//i,notLink:/^(?:img|a|input|audio|video|source|code|pre|script|head|title|style)$/i,maxLength:100},F={bold:{styleKey:"font-weight",correctValue:"normal"},italic:{styleKey:"font-style",correctValue:"normal"},underline:{styleKey:"text-decoration",correctValue:"none"}};K.is=function(e,t){return Object.prototype.toString.call(e).slice(8,-1)===t},K.forEach=function(e,t,n){if(e)if(null==n&&(n=K.is(e,"Array")),n)for(var i=0,r=e.length;i<r;i++)t(e[i],i,e);else for(var o in e)e.hasOwnProperty(o)&&t(e[o],o,e)},K.copy=function(e,t){return K.forEach(t,function(t,n){e[n]=K.is(t,"Object")?K.copy({},t):K.is(t,"Array")?K.copy([],t):t}),e},K.log=function(e,t){(P||t)&&console.log("%cPEN DEBUGGER: %c"+e,"font-family:arial,sans-serif;color:#1abf89;line-height:2em;","font-family:cursor,monospace;color:#333;")},K.delayExec=function(e){var t=null;return function(n){clearTimeout(t),t=setTimeout(function(){e()},n||1)}},K.merge=function(e){var n={class:"pen",placeholderClass:"pen-placeholder",placeholderAttr:"data-pen-placeholder",debug:!1,toolbar:null,mode:"basic",toolbarIconsPrefix:"fa fa-",toolbarIconsDictionary:{externalLink:"fa fa-external-link"},stay:e.stay||!e.debug,stayMsg:"Are you going to leave here?",textarea:'<textarea name="content"></textarea>',list:["blockquote","h2","h3","p","code","insertOrderedList","insertUnorderedList","inserthorizontalrule","indent","outdent","bold","italic","underline","createlink","insertimage"],titles:{},cleanAttrs:["id","class","style","name"],cleanTags:["script"],linksInNewWindow:!1};return 1===e.nodeType?n.editor=e:e.match&&e.match(/^#[\S]+$/)?n.editor=t.getElementById(e.slice(1)):n=K.copy(n,e),n},(D=function(e){if(!e)throw new Error("Can't find config");P=e.debug;var t=K.merge(e),n=t.editor;if(!n||1!==n.nodeType)throw new Error("Can't find editor");n.classList.add(t.class),n.setAttribute("contenteditable","true"),this.config=t,t.placeholder&&n.setAttribute(this.config.placeholderAttr,t.placeholder),E(this),this.selection=U,this._events={change:[]},y(this),b(this),this._prevContent=this.getContent(),this.markdown&&this.markdown.init(this),this.config.stay&&this.stay(this.config),this.config.input&&this.addOnSubmitListener(this.config.input),"advanced"===this.config.mode?(this.getRange().selectNodeContents(n),this.setRange()):R(this)}).prototype.on=function(e,t){return _(this,this.config.editor,e,t),this},D.prototype.addOnSubmitListener=function(e){var t=this;e.form.addEventListener("submit",function(){e.value=t.config.saveAsMarkdown?t.toMd(t.config.editor.innerHTML):t.config.editor.innerHTML})},D.prototype.isEmpty=function(e){return!((e=e||this.config.editor).querySelector("img")||e.querySelector("blockquote")||e.querySelector("li")||N(e.textContent))},D.prototype.getContent=function(){return this.isEmpty()?"":N(this.config.editor.innerHTML)},D.prototype.setContent=function(e){return this.config.editor.innerHTML=e,this.cleanContent(),this},D.prototype.checkContentChange=function(){var e=this._prevContent,t=this.getContent();e!==t&&(this._prevContent=t,C(this,"change",t,e))},D.prototype.getRange=function(){var e=this.config.editor,n=U.rangeCount&&U.getRangeAt(0);return n||(n=t.createRange()),L(e,n.commonAncestorContainer)||(n.selectNodeContents(e),n.collapse(!1)),n},D.prototype.setRange=function(e){(e=e||this._range)||(e=this.getRange()).collapse(!1);try{U.removeAllRanges(),U.addRange(e)}catch(e){}return this},D.prototype.focus=function(e){return e||this.setRange(),this.config.editor.focus(),this},D.prototype.execCommand=function(e,t){if(e=e.toLowerCase(),this.setRange(),V.block.test(e))r(this,e);else if(V.inline.test(e))n(e,t);else if(V.biu.test(e)){var c=F[e];c.backupValue=this.config.editor.style[c.styleKey],this.config.editor.style[c.styleKey]=c.correctValue,n(e,t),this.config.editor.style[c.styleKey]=c.backupValue}else V.source.test(e)?a(this,e,t):V.insert.test(e)?i(this,e,t):V.wrap.test(e)?o(this,e,t):K.log("can not find command function for name: "+e+(t?", value: "+t:""),!0);"indent"===e&&this.checkContentChange()},D.prototype.cleanContent=function(e){var t=this.config.editor;return e||(e=this.config),K.forEach(e.cleanAttrs,function(e){K.forEach(t.querySelectorAll("["+e+"]"),function(t){t.removeAttribute(e)},!0)},!0),K.forEach(e.cleanTags,function(e){K.forEach(t.querySelectorAll(e),function(e){e.parentNode.removeChild(e)},!0)},!0),E(this),this.checkContentChange(),this},D.prototype.autoLink=function(){return q(this.config.editor),this.getContent()},D.prototype.highlight=function(){var e=this._toolbar||this._menu,t=w(this);if(K.forEach(e.querySelectorAll(".active"),function(e){e.classList.remove("active")},!0),!t)return this;var n,i=T(this),r=this._urlInput,o=this._externalUrlCheckbox;return r&&e===this._menu&&(r.value="",this._externalUrlCheckbox.checked=!1),n=function(t){if(t){var n=e.querySelector("[data-action="+t+"]");return n&&n.classList.add("active")}},K.forEach(i,function(e){var t=e.nodeName.toLowerCase(),i=e.style.textAlign,a=e.style.textDecoration;if(i&&("justify"===i&&(i="full"),n("justify"+i[0].toUpperCase()+i.slice(1))),"underline"===a&&n("underline"),t.match(W)){switch(t){case"a":r.value=e.getAttribute("href"),o.checked="_blank"===e.getAttribute("target"),t="createlink";break;case"img":r.value=e.getAttribute("src"),t="insertimage";break;case"i":case"em":t="italic";break;case"u":t="underline";break;case"b":case"strong":t="bold";break;case"strike":t="strikethrough";break;case"ul":t="insertUnorderedList";break;case"ol":t="insertOrderedList";break;case"li":t="indent"}n(t)}},!0),this},D.prototype.menu=function(){return this._menu?U.isCollapsed?(this._menu.style.display="none",this._inputActive=!1,this):!this._toolbar||this._urlInput&&this._inputActive?void u(this):this:this},D.prototype.refreshMenuPosition=function(){var e=this._range.getBoundingClientRect(),t=e.top-10,n=e.left+e.width/2,i=this._menu,r={x:0,y:0},o=this._stylesheet;if(0===e.width&&0===e.height)return this;if(void 0===this._stylesheet){var a=document.createElement("style");document.head.appendChild(a),this._stylesheet=o=a.sheet}return i.style.display="flex",r.x=n-i.clientWidth/2,r.y=t-i.clientHeight,o.cssRules.length>0&&o.deleteRule(0),r.x<0?(r.x=0,o.insertRule(".pen-menu:after {left: "+n+"px;}",0)):o.insertRule(".pen-menu:after {left: 50%; }",0),r.y<0?(i.classList.add("pen-menu-below"),r.y=e.top+e.height+10):i.classList.remove("pen-menu-below"),i.style.top=r.y+"px",i.style.left=r.x+"px",this},D.prototype.stay=function(e){var t=this;window.onbeforeunload||(window.onbeforeunload=function(){if(!t._isDestroyed)return e.stayMsg})},D.prototype.destroy=function(){var e=this.config;k(this),e.editor.classList.remove(e.class,e.placeholderClass),e.editor.removeAttribute("contenteditable"),e.editor.removeAttribute(e.placeholderAttr);try{U.removeAllRanges(),this._menu&&this._menu.parentNode.removeChild(this._menu)}catch(e){}return this._isDestroyed=!0,this},D.prototype.rebuild=function(){return y(this),b(this),this},e.ElementorInlineEditor=function(e){if(!e)return K.log("can't find config",!0);var t=K.merge(e),n=t.editor.getAttribute("class");return n=n?n.replace(/\bpen\b/g,"")+" pen-textarea "+t.class:"pen pen-textarea",t.editor.setAttribute("class",n),t.editor.innerHTML=t.textarea,t.editor};var J={a:[/<a\b[^>]*href=["']([^"]+|[^']+)\b[^>]*>(.*?)<\/a>/gi,"[$2]($1)"],img:[/<img\b[^>]*src=["']([^\"+|[^']+)[^>]*>/gi,"![]($1)"],b:[/<b\b[^>]*>(.*?)<\/b>/gi,"**$1**"],i:[/<i\b[^>]*>(.*?)<\/i>/gi,"***$1***"],h:[/<h([1-6])\b[^>]*>(.*?)<\/h\1>/gi,function(e,t,n){return"\n"+"######".slice(0,t)+" "+n+"\n"}],li:[/<(li)\b[^>]*>(.*?)<\/\1>/gi,"* $2\n"],blockquote:[/<(blockquote)\b[^>]*>(.*?)<\/\1>/gi,"\n> $2\n"],pre:[/<pre\b[^>]*>(.*?)<\/pre>/gi,"\n```\n$1\n```\n"],code:[/<code\b[^>]*>(.*?)<\/code>/gi,"\n`\n$1\n`\n"],p:[/<p\b[^>]*>(.*?)<\/p>/gi,"\n$1\n"],hr:[/<hr\b[^>]*>/gi,"\n---\n"]};D.prototype.toMd=function(){var e=this.getContent().replace(/\n+/g,"").replace(/<([uo])l\b[^>]*>(.*?)<\/\1l>/gi,"$2");for(var t in J)J.hasOwnProperty(t)&&(e=e.replace.apply(e,J[t]));return e.replace(/\*{5}/g,"**")},t.getSelection&&(U=t.getSelection(),e.ElementorInlineEditor=D)}(window,document);